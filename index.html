<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
        <html>
                <svg
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                x="0px"
                y="0px"
                viewBox="0 0 1600 1187"
                xml:space="preserve"
                width="100vw"
                height="100vh"
              >
                <path
                  id="base-path"
                  d="M282.2,1123.5c25.4,3.7,46.4,2.9,60.8,1.4c13.6-1.4,29.7-3.1,48.6-10.8
              c8.7-3.5,27.4-12.1,48.6-32.4c40.1-38.4,31.2-63.3,60.8-95.9C536.1,947,586.8,940,607.8,937c55.5-7.8,98.5,9.7,120.3,18.9
              c67.1,28.3,67.9,60.1,144.6,114.9c31.2,22.3,82.5,58.1,156.8,74.3c15.7,3.4,106.5,22.1,178.4-17.6c25.9-14.3,35.8-28.7,40.5-40.5
              c8.2-20.3,6.3-44.8-4.1-62.2c-8.8-14.8-27.8-31.3-104.1-39.2c-93.7-9.7-109.3,10.6-187.8-1.4c-68.8-10.5-97.6-32.3-113.5-51.4
              c-6.6-7.8-20-24.3-21.6-48.6c-0.2-2.9-2-36.5,21.6-58.1c18.8-17.2,43.7-17.5,55.4-17.6c87.6-0.8,160.1,63.7,287.8,109.5
              c10.9,3.9,30.2,10.5,55.4,9.5c16.4-0.7,74.1-6.3,106.8-56.8c3.6-5.6,38.7-62,8.1-118.9c-21.1-39.3-63.2-57.8-97.3-59.5
              c-46.6-2.3-54.1,28.1-118.9,40.5c-15.7,3-67,12.2-120.3-8.1c-47.1-18-47.3-40.7-104.1-74.3c-16.6-9.9-61.4-35.9-117.6-43.2
              c-88.9-11.6-160.5,29.8-178.4,40.5c-91.4,54.6-66.8,108.2-163.5,183.8c-24.7,19.3-110.4,86.3-210.8,73
              c-12.8-1.7-62.4-8.9-106.8-44.6c-26.7-21.5-37.9-42.3-40.5-47.3c-4.7-9-15.4-29.6-14.9-54.1c0.9-38.1,27.9-72.5,58.1-87.8
              c9.2-4.7,30.7-13.6,113.5,2.7c101.1,20,132.9,45.9,170.3,25.7c3.6-2,31.5-17.6,37.8-48.6c3.8-18.8-0.8-40.4-13.5-55.4
              c-11.6-13.7-19.9-10.2-52.7-28.4c-22.8-12.6-36.9-20.4-48.6-36.5c-4.3-5.9-18.9-26.5-17.6-55.4c1.4-29.7,18.7-49.2,23-54.1
              c9.3-10.5,37.6-37.2,112.2-35.1c103.2,2.9,152.1,56.9,289.2,118.9c105.3,47.7,187.5,66.1,237.8,77c76.6,16.7,157.9,26.8,248.6,6.8
              c71.1-15.7,95.9-38.3,109.5-56.8c2.3-3.1,39.2-55.1,20.3-113.5c-2.6-8-10.8-33.2-33.8-51.4c-19.6-15.4-29.3-9.4-51.4-25.7
              c-24.6-18.1-36.1-42.9-40.5-52.7c-12.8-28.3-4.6-35-17.6-56.8c-4.4-7.4-18.9-29.4-47.3-40.5c-4.1-1.6-28-10.6-55.4-4.1
              c-14.7,3.5-39.9,13.8-83.8,82.4C995,336.1,1005,347.9,974.1,383c-12.7,14.4-47.3,53.6-100,62.2c-40.9,6.7-73-8.3-120.3-31.1
              c-88.6-42.8-91.3-76.4-158.1-97.3c-41.5-13-75.3-11-124.3-8.1c-84.4,5-99.3,26.3-179.7,24.3c-39.9-1-75.2-7.2-108.1-27
              c-26.6-16-39.4-33.6-43.2-39.2c-6.1-8.8-20.5-30.3-21.6-60.8c-0.9-23.9,6.7-41.3,13.5-56.8c5.5-12.5,14.7-32.9,35.1-51.4
            c19.6-17.6,39.6-24.5,51.4-28.4c18.4-6.1,57.5-15.7,112.2-2.7c64.8,15.4,89.7,47.9,151.4,87.8c36.7,23.8,91.6,53.6,167.6,75.7"
                />
                <g id="bridges"></g>
                <g id="boxes"></g>
          
                <!-- gingerbread source www.flaticon.com -->
          
                <g id="gingerbread">
                  <path
                    style="fill:#A46F3E;"
                    d="M42.48,25.681l4.669-2.146c2.919-0.793,4.659-3.83,3.867-6.749c-0.793-2.919-3.83-4.659-6.749-3.866
                l-7.312,5.053C36.304,18.272,35.603,17.7,35.754,17c0.177-0.82,1.962-0.969,1.962-5.068C37.716,7.289,36.764,0,28.456,0
                c-8.723,0-9.723,6.679-9.723,12c0,3.063,1.848,4.369,1.981,5c0.144,0.685-0.544,1.243-1.186,0.965l-8.794-5.581
                c-2.919-0.793-5.956,0.947-6.749,3.867h0C3.191,19.17,4.931,22.207,7.85,23l6.007,2.601c2.011,1.232,5.846,4.412,4.022,9.966
                l-4.921,8.59c-2.728,0.655-4.685,3.351-4.131,6.37C9.312,53.162,11.739,55,14.42,55h1.813c0.079,0,0.156-0.009,0.235-0.012
                c0.085-0.004,0.17-0.005,0.254-0.013c0.283-0.025,0.558-0.075,0.827-0.142c0.069-0.017,0.138-0.034,0.206-0.053
                c0.267-0.078,0.524-0.176,0.773-0.291c0.079-0.036,0.156-0.073,0.233-0.113c0.227-0.118,0.443-0.253,0.65-0.4
                c0.09-0.064,0.178-0.128,0.264-0.198c0.19-0.153,0.368-0.321,0.536-0.498c0.077-0.081,0.153-0.161,0.225-0.248
                c0.175-0.208,0.332-0.432,0.476-0.664c0.027-0.044,0.063-0.078,0.088-0.123l5.573-7.895c0.809-1.146,2.509-1.146,3.318,0
                l5.573,7.895c0.026,0.045,0.061,0.079,0.088,0.123c0.144,0.233,0.3,0.456,0.476,0.664c0.072,0.086,0.148,0.167,0.225,0.248
                c0.168,0.177,0.346,0.344,0.536,0.498c0.086,0.069,0.174,0.134,0.264,0.198c0.207,0.148,0.423,0.282,0.65,0.4
                c0.077,0.04,0.154,0.076,0.233,0.113c0.249,0.115,0.506,0.214,0.773,0.291c0.069,0.02,0.137,0.036,0.206,0.053
                c0.269,0.067,0.544,0.117,0.827,0.142c0.085,0.008,0.169,0.009,0.254,0.013C40.077,54.991,40.154,55,40.233,55h1.813
                c2.68,0,5.108-1.838,5.592-4.474c0.555-3.019-1.402-5.715-4.131-6.37l-4.921-8.59C36.801,30.129,40.439,26.967,42.48,25.681z"
                  />
                  <circle style="fill:#ED3F32;" cx="28.233" cy="35.5" r="2.5" />
                  <circle style="fill:#88C057;" cx="28.233" cy="26.5" r="2.5" />
                  <circle style="fill:#FFF5BB;" cx="31.733" cy="7" r="2" />
                  <circle style="fill:#FFF5BB;" cx="24.733" cy="7" r="2" />
                  <path
                    style="fill:#FFF5BB;"
                    d="M28.233,16.375c-2.661-0.027-5.5-1.792-5.5-4.375c0-0.553,0.447-1,1-1s1,0.447,1,1
                c0,1.202,1.706,2.356,3.511,2.375c1.756,0,3.489-1.177,3.489-2.375c0-0.553,0.447-1,1-1s1,0.447,1,1
                C33.733,14.578,30.835,16.375,28.233,16.375z"
                  />
                  <path
                    style="fill:#FFF5BB;"
                    d="M43.937,13.148l-1.659,1.146l4.818,9.266l0.053-0.024c0.649-0.176,1.235-0.468,1.752-0.84
                L43.937,13.148z"
                  />
                  <polygon
                    style="fill:#FFF5BB;"
                    points="32.435,47.953 42.344,42.125 41.35,40.389 31.278,46.313 	"
                  />
                  <path
                    style="fill:#FFF5BB;"
                    d="M34.43,50.78l10.395-6.115c-0.412-0.222-0.852-0.397-1.317-0.509l-0.444-0.776l-9.791,5.759
                L34.43,50.78z"
                  />
                  <polygon
                    style="fill:#FFF5BB;"
                    points="25.686,45.608 15.145,40.338 14.15,42.076 24.519,47.261 	"
                  />
                  <path
                    style="fill:#FFF5BB;"
                    d="M22.643,49.919l1.17-1.657l-10.352-4.984l-0.503,0.879c-0.449,0.108-0.874,0.276-1.273,0.486
                L22.643,49.919z"
                  />
                  <path
                    style="fill:#FFF5BB;"
                    d="M6.733,22.556C7.083,22.74,7.454,22.893,7.85,23l0.733,0.317l3.923-9.808l-1.718-1.09L6.733,22.556z
                "
                  />
                </g>
              </svg>
              <div class="card">
                <div class="card-color"></div>
              </div>
        </html>
        <style>
                body{
                    margin:0;
                    overflow: hidden;
                  }
                  #base-path{
                    fill:none;
                    stroke: #dddddd77;
                    stroke-width: 35;
                    stroke-miterlimit: 10;
                  }
                  
                  svg{
                    background: #e78fb3;
                  }
                  .card{
                    position: fixed;
                    background: #fff;
                    width:100px;
                    height: 150px;
                    right:0.5rem;
                    top:0.5rem;
                    border-radius: 8px;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                  }
                  .card-color{
                    width: 80px;
                    height: 80px;
                    background: #fff;
                    border-radius: 8px;
                  }
                  
        </style>
        <script>
            let currentIndex = 0;
        const originalPath = document.getElementById("base-path");
        const precision = 4;
        const singleElementLength = originalPath.getTotalLength() / (134 * precision);
        const range = i =>
          Array(i)
            .fill(0)
            .map((_, ix) => ix);
        
        const colors = [
          "#fe7c64",
          "#c42dda",
          "#effb50",
          "#0044f1",
          "#fcd560",
          "#1cab97"
        ];
        const pinkLocations = [8, 19, 41, 68, 91, 101];
        let iColor = -1;
        const getC = () => {
          iColor += 1;
          if (iColor === colors.length) {
            iColor = 0;
          }
          return colors[iColor];
        };
        
        const colorMap = range(134).map(
          i => (pinkLocations.includes(i) && "#f7c5f7") || getC()
        );
        
        const seekNext = color => {
          return colorMap.indexOf(color, currentIndex + 1);
        };
        
        const getPoint = index => {
          const lengthToPart = singleElementLength * index;
          const { x, y } = originalPath.getPointAtLength(lengthToPart);
          return { x, y };
        };
        const g = d3.select("#boxes");
        
        const points = [];
        
        range(134).forEach(index => {
          const start = index * precision;
          const p0 = getPoint(start);
          let d = `M${p0.x},${p0.y}`;
          range(precision).forEach(i => {
            const { x, y } = getPoint(start + (i + 1));
            d += `L${x},${y}`;
          });
          g.append("path")
            .attr("d", d)
            .attr("fill", "none")
            .attr("stroke", colorMap[index])
            .attr("stroke-width", "25");
          const mx = getPoint(start + precision / 2);
          points.push(mx);
        });
        
        const bridges = d3.select("#bridges");
        bridges
          .append("path")
          .attr("d", `M${points[4].x},${points[4].y}L${points[58].x},${points[58].y}`)
          .attr("fill", "none")
          .attr("stroke", "#d5a360")
          .attr("stroke-width", "25");
        bridges
          .append("path")
          .attr("d", `M${points[34].x},${points[34].y}L${points[44].x},${points[44].y}`)
          .attr("fill", "none")
          .attr("stroke", "#d5a360")
          .attr("stroke-width", "25");
        
        const origin = points[0];
        d3.select("#gingerbread").attr(
          "transform",
          `translate(${origin.x - 28}, ${origin.y - 28})`
        );
        
        const pickRandom = () => colors[Math.floor(Math.random() * colors.length)];
        
        const loop = () => {
          if (currentIndex >= 134) {
            return null
          }
          const tl = gsap.timeline({ onComplete: loop });
          const rColor = pickRandom();
          const nextLoc = seekNext(rColor);
          if (nextLoc > 0) {
            currentIndex = nextLoc;
        
            tl.to(".card-color", {
              scale:0,
              duration: 1
            });
            tl.to(".card-color", {
              background:rColor,
              scale:1,
              duration: 2,
            });
            tl.to("#gingerbread", {
              x: points[currentIndex].x - 28,
              y: points[currentIndex].y - 28,
              duration: 2
            });
            if ([4, 58, 34, 44].includes(currentIndex)) {
              let bridgeEndLoc;
              switch (currentIndex) {
                case 4:
                  bridgeEndLoc = 58;
                  break;
                case 58:
                  bridgeEndLoc = 4;
                  break;
                case 34:
                  bridgeEndLoc = 44;
                  break;
                case 44:
                  bridgeEndLoc = 34;
                  break;
                default:
                  bridgeEndLoc = currentIndex;
              }
              currentIndex = bridgeEndLoc;
              tl.to("#gingerbread", {
                x: points[currentIndex].x - 28,
                y: points[currentIndex].y - 28,
                duration: 2
              });
            }
          }
        
          // TODO : distinct locations and cards with two color boxes
        };
        
        loop();
</body>
</html>